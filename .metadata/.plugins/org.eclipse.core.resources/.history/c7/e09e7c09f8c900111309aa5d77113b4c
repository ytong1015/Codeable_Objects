package com.primitive2d;

import java.util.Vector;

import processing.core.PApplet;

import com.datatype.Point;
import com.math.Geom;

public class Curve extends LineCollection implements Drawable{ //series of symmetrical curved lines grouped together in a single line
	private Vector<HalfCurve> halfCurves = new Vector<HalfCurve>(); //stores all of the individual parabolas
	private int resolution = 100; // resolution of each curve
	
	
	
	public Curve(Point start, Point end, Point control){
		super();
		HalfCurve hCurve = new HalfCurve(start,end,control,resolution);
		this.halfCurves.add(hCurve);
	}

	
	public void addCurve(Point end, Point control){
		Point start = halfCurves.get(halfCurves.size()-1).end;
		HalfCurve hCurve = new HalfCurve(start,end,control,resolution);
		this.halfCurves.add(hCurve);
	}
	
	//=============================DRAW AND PRINT METHODS==================================//

	@Override
	 public void draw(PApplet parent, float strokeWeight){
		for(int i =0;i<halfCurves.size();i++){
			
			this.halfCurves.get(i).draw(parent, strokeWeight);
		}
		this.drawPoints(parent);
		
	 }
	
	public void drawPoints(PApplet parent){
		for(int i =0;i<halfCurves.size();i++){
		 
		 parent.strokeWeight(4);
		 HalfCurve hCurve = this.halfCurves.get(i);
		 
		 parent.stroke(152,251,152);
		 parent.point((float)hCurve.start.getX(), (float)hCurve.start.getY());
		 parent.stroke(255,105,180);
		 parent.point((float)hCurve.end.getX(), (float)hCurve.end.getY());
		 parent.stroke(171,130,255);
		 parent.point((float)hCurve.control.getX(), (float)hCurve.control.getY());
		
		} 
		 
	 }
	
	@Override
	 public void print(PApplet parent, float strokeWeight, String filename){
		for(int i =0;i<halfCurves.size();i++){
			this.halfCurves.get(i).print(parent, strokeWeight, filename);
		}
		
	 }
	

}


class HalfCurve extends LineCollection{
	public Point control;
	private int resolution;
	public Point start;
	public Point end;
	
	
	public HalfCurve(Point p1, Point p2, Point control, int resolution){
		super();
		
		
		
		this.resolution=resolution;
		
		
		calcCurve(p1,p2,control);
	
		
	}
	
	
	public void calcCurve(Point p1, Point p2, Point control){
		Point centerPoint = Geom.getMidpoint(p1, p2);
		double theta = Geom.cartToPolar(control.getX()-centerPoint.getX(), control.getY()-centerPoint.getY())[1];
		if((theta<180 || theta <=0)){
			calculateHorzCurve(p1,p2,control);
		}
		else{
			calculateVertCurve(p1,p2,control);
		}
	}
	
	private void calculateVertCurve(Point p1, Point p2, Point control){
		this.control= control;
		if(p1.getY()<=p2.getY()){
			this.start=p1;
			this.end = p2;
		}
		else{
			this.start = p2;
			this.end=p1;
		}

		/*if(control.getY()<=start.getY()){
			control.setY(start.getY()+1);
		}
		if(control.getY()>=end.getY()){
			control.setY(end.getY()-1);
		}*/
		
		double y1 = end.getY();
		double x1 = end.getX();
		double y2 = control.getY();
		double x2 = control.getX();
		double y3 = start.getY();
		double x3 = start.getX();
		
		double height = end.getY()-start.getY();
		double width = end.getX()-start.getX();

		double denom = (y1 - y2) * (y1 - y3) * (y2 - y3);
		double a = (y3 * (x2 - x1) + y2 * (x1 - x3) + y1 * (x3 - x2)) / denom;
		double b = (Math.pow((float) y3, 2.0) * (x1 - x2) + Math.pow((float) y2, 2.0) * (x3 - x1) + Math.pow((float) y1, 2.0) * (x2 - x3)) / denom;
		double c = (y2 * y3 * (y2 - y3) * x1 + y3 * y1 * (y3 - y1) * x2 + y1 * y2 * (y1 - y2) * x3) / denom;


		for (int i = 0; i < resolution + 1; i++) {
			double startPointY = (height / resolution) * i+start.getY();

			double startPointX = a * startPointY * startPointY + b * startPointY + c;
			
			this.addPoint(startPointX,startPointY);	
		}
	}
	
private void calculateHorzCurve(Point p1, Point p2, Point control){
	this.control= control;
	if(p1.getX()<=p2.getY()){
		this.start=p1;
		this.end = p2;
	}
	else{
		this.start = p2;
		this.end=p1;
	}
	
	/*if(control.getX()<=start.getX()){
		control.setX(start.getX()+1);
	}
	if(control.getX()>=end.getX()){
		control.setX(end.getX()-1);
	}*/

		double y1 = end.getY();
		double x1 = end.getX();
		double y2 = control.getY();
		double x2 = control.getX();
		double y3 = start.getY();
		double x3 = start.getX();
		
		double height = end.getY()-start.getY();
		double width = end.getX()-start.getX();

		double denom = (x1 - x2) * (x1 - x3) * (x2 - x3);
		double a = (x3 * (y2 - y1) + x2 * (y1 - y3) + x1 * (y3 - y2)) / denom;
		double b = (Math.pow((float) x3, 2.0) * (y1 - y2) + Math.pow((float) x2, 2.0) * (y3 - y1) + Math.pow((float) x1, 2.0) * (y2 - y3)) / denom;
		double c = (x2 * x3 * (x2 - x3) * y1 + x3 * x1 * (x3 - x1) * y2 + x1 * x2 * (x1 - x2) * y3) / denom;


		for (int i = 0; i < resolution + 1; i++) {
			double startPointX = (width / resolution) * i+ start.getX();

			double startPointY = a * startPointX * startPointX+ b * startPointX + c;
			
			this.addPoint(startPointX,startPointY);	
		}
	}
	
	@Override
	public void addPoint(double x,double y){ //copied from Polygon class
		
		Point point = new Point(x,y);
		
		int numLines = this.getAllLines().size();
		int numPoints = this.getAllPoints().size();
		if(numPoints == 0){
			this.addPoint(point);
		}
		else if(numLines==0){
			Line line = new Line(this.getPointAt(0),point);
			this.addLineWithoutPoints(line);
			this.addPoint(point);
		}
		if(numLines>0){
			Point start = this.getLineAt(numLines-1).end;
			Line line = new Line(start.copy(),point.copy());
			this.addLine(line);
		}
		
		
		
	}

	
}